/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
import { isDevMode } from '@angular/core';
import { Subject } from 'rxjs';
/**
 * Maintains a set of selected items. Support selecting and deselecting items, and checking if a
 * value is selected.
 * When constructed with a `trackByFn`, all the items will be identified by applying the `trackByFn`
 * on them. Because `trackByFn` requires the index of the item to be passed in, the `index` field is
 * expected to be set when calling `isSelected`, `select` and `deselect`.
 */
export class SelectionSet {
    constructor(_multiple = false, _trackByFn) {
        this._multiple = _multiple;
        this._trackByFn = _trackByFn;
        this._selectionMap = new Map();
        this.changed = new Subject();
    }
    isSelected(value) {
        return this._selectionMap.has(this._getTrackedByValue(value));
    }
    select(...selects) {
        if (!this._multiple && selects.length > 1 && isDevMode()) {
            throw Error('SelectionSet: not multiple selection');
        }
        const before = this._getCurrentSelection();
        if (!this._multiple) {
            this._selectionMap.clear();
        }
        const toSelect = [];
        for (const select of selects) {
            if (this.isSelected(select)) {
                continue;
            }
            toSelect.push(select);
            this._markSelected(this._getTrackedByValue(select), select);
        }
        const after = this._getCurrentSelection();
        this.changed.next({ before, after });
    }
    deselect(...selects) {
        if (!this._multiple && selects.length > 1 && isDevMode()) {
            throw Error('SelectionSet: not multiple selection');
        }
        const before = this._getCurrentSelection();
        const toDeselect = [];
        for (const select of selects) {
            if (!this.isSelected(select)) {
                continue;
            }
            toDeselect.push(select);
            this._markDeselected(this._getTrackedByValue(select));
        }
        const after = this._getCurrentSelection();
        this.changed.next({ before, after });
    }
    _markSelected(key, toSelect) {
        this._selectionMap.set(key, toSelect);
    }
    _markDeselected(key) {
        this._selectionMap.delete(key);
    }
    _getTrackedByValue(select) {
        if (!this._trackByFn) {
            return select.value;
        }
        if (select.index == null && isDevMode()) {
            throw Error('SelectionSet: index required when trackByFn is used.');
        }
        return this._trackByFn(select.index, select.value);
    }
    _getCurrentSelection() {
        return Array.from(this._selectionMap.values());
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0aW9uLXNldC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jZGstZXhwZXJpbWVudGFsL3NlbGVjdGlvbi9zZWxlY3Rpb24tc2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7R0FNRztBQUVILE9BQU8sRUFBQyxTQUFTLEVBQWtCLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxNQUFNLENBQUM7QUE4QjdCOzs7Ozs7R0FNRztBQUNILE1BQU0sT0FBTyxZQUFZO0lBSXZCLFlBQW9CLFlBQVksS0FBSyxFQUFVLFVBQStCO1FBQTFELGNBQVMsR0FBVCxTQUFTLENBQVE7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFxQjtRQUh0RSxrQkFBYSxHQUFHLElBQUksR0FBRyxFQUE0RCxDQUFDO1FBQzVGLFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBc0IsQ0FBQztJQUVxQyxDQUFDO0lBRWxGLFVBQVUsQ0FBQyxLQUE2QjtRQUN0QyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxPQUFpQztRQUN6QyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxTQUFTLEVBQUUsRUFBRTtZQUN4RCxNQUFNLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1NBQ3JEO1FBRUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFFM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDbkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUM1QjtRQUVELE1BQU0sUUFBUSxHQUE2QixFQUFFLENBQUM7UUFDOUMsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7WUFDNUIsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUMzQixTQUFTO2FBQ1Y7WUFFRCxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzdEO1FBRUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFFMUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsUUFBUSxDQUFDLEdBQUcsT0FBaUM7UUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksU0FBUyxFQUFFLEVBQUU7WUFDeEQsTUFBTSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztTQUNyRDtRQUVELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzNDLE1BQU0sVUFBVSxHQUE2QixFQUFFLENBQUM7UUFFaEQsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7WUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzVCLFNBQVM7YUFDVjtZQUVELFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztTQUN2RDtRQUVELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVPLGFBQWEsQ0FBQyxHQUFxQyxFQUFFLFFBQWdDO1FBQzNGLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRU8sZUFBZSxDQUFDLEdBQXFDO1FBQzNELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFTyxrQkFBa0IsQ0FBQyxNQUE4QjtRQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNwQixPQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDckI7UUFFRCxJQUFJLE1BQU0sQ0FBQyxLQUFLLElBQUksSUFBSSxJQUFJLFNBQVMsRUFBRSxFQUFFO1lBQ3ZDLE1BQU0sS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7U0FDckU7UUFFRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQU0sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVPLG9CQUFvQjtRQUMxQixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2pELENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgTExDIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuXG5pbXBvcnQge2lzRGV2TW9kZSwgVHJhY2tCeUZ1bmN0aW9ufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7U3ViamVjdH0gZnJvbSAncnhqcyc7XG5cbi8qKlxuICogTWFpbnRhaW5zIGEgc2V0IG9mIHNlbGVjdGVkIHZhbHVlcy4gT25lIG9yIG1vcmUgdmFsdWVzIGNhbiBiZSBhZGRlZCB0byBvciByZW1vdmVkIGZyb20gdGhlXG4gKiBzZWxlY3Rpb24uXG4gKi9cbmludGVyZmFjZSBUcmFja0J5U2VsZWN0aW9uPFQ+IHtcbiAgaXNTZWxlY3RlZCh2YWx1ZTogU2VsZWN0YWJsZVdpdGhJbmRleDxUPik6IGJvb2xlYW47XG4gIHNlbGVjdCguLi52YWx1ZXM6IFNlbGVjdGFibGVXaXRoSW5kZXg8VD5bXSk6IHZvaWQ7XG4gIGRlc2VsZWN0KC4uLnZhbHVlczogU2VsZWN0YWJsZVdpdGhJbmRleDxUPltdKTogdm9pZDtcbiAgY2hhbmdlZDogU3ViamVjdDxTZWxlY3Rpb25DaGFuZ2U8VD4+O1xufVxuXG4vKipcbiAqIEEgc2VsZWN0YWJsZSB2YWx1ZSB3aXRoIGFuIG9wdGlvbmFsIGluZGV4LiBUaGUgaW5kZXggaXMgcmVxdWlyZWQgd2hlbiB0aGUgc2VsZWN0aW9uIGlzIHVzZWQgd2l0aFxuICogYHRyYWNrQnlgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdGFibGVXaXRoSW5kZXg8VD4ge1xuICB2YWx1ZTogVDtcbiAgaW5kZXg/OiBudW1iZXI7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgY2hhbmdlIGluIHRoZSBzZWxlY3Rpb24gc2V0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdGlvbkNoYW5nZTxUPiB7XG4gIGJlZm9yZTogU2VsZWN0YWJsZVdpdGhJbmRleDxUPltdO1xuICBhZnRlcjogU2VsZWN0YWJsZVdpdGhJbmRleDxUPltdO1xufVxuXG4vKipcbiAqIE1haW50YWlucyBhIHNldCBvZiBzZWxlY3RlZCBpdGVtcy4gU3VwcG9ydCBzZWxlY3RpbmcgYW5kIGRlc2VsZWN0aW5nIGl0ZW1zLCBhbmQgY2hlY2tpbmcgaWYgYVxuICogdmFsdWUgaXMgc2VsZWN0ZWQuXG4gKiBXaGVuIGNvbnN0cnVjdGVkIHdpdGggYSBgdHJhY2tCeUZuYCwgYWxsIHRoZSBpdGVtcyB3aWxsIGJlIGlkZW50aWZpZWQgYnkgYXBwbHlpbmcgdGhlIGB0cmFja0J5Rm5gXG4gKiBvbiB0aGVtLiBCZWNhdXNlIGB0cmFja0J5Rm5gIHJlcXVpcmVzIHRoZSBpbmRleCBvZiB0aGUgaXRlbSB0byBiZSBwYXNzZWQgaW4sIHRoZSBgaW5kZXhgIGZpZWxkIGlzXG4gKiBleHBlY3RlZCB0byBiZSBzZXQgd2hlbiBjYWxsaW5nIGBpc1NlbGVjdGVkYCwgYHNlbGVjdGAgYW5kIGBkZXNlbGVjdGAuXG4gKi9cbmV4cG9ydCBjbGFzcyBTZWxlY3Rpb25TZXQ8VD4gaW1wbGVtZW50cyBUcmFja0J5U2VsZWN0aW9uPFQ+IHtcbiAgcHJpdmF0ZSBfc2VsZWN0aW9uTWFwID0gbmV3IE1hcDxUfFJldHVyblR5cGU8VHJhY2tCeUZ1bmN0aW9uPFQ+PiwgU2VsZWN0YWJsZVdpdGhJbmRleDxUPj4oKTtcbiAgY2hhbmdlZCA9IG5ldyBTdWJqZWN0PFNlbGVjdGlvbkNoYW5nZTxUPj4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9tdWx0aXBsZSA9IGZhbHNlLCBwcml2YXRlIF90cmFja0J5Rm4/OiBUcmFja0J5RnVuY3Rpb248VD4pIHt9XG5cbiAgaXNTZWxlY3RlZCh2YWx1ZTogU2VsZWN0YWJsZVdpdGhJbmRleDxUPik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb25NYXAuaGFzKHRoaXMuX2dldFRyYWNrZWRCeVZhbHVlKHZhbHVlKSk7XG4gIH1cblxuICBzZWxlY3QoLi4uc2VsZWN0czogU2VsZWN0YWJsZVdpdGhJbmRleDxUPltdKSB7XG4gICAgaWYgKCF0aGlzLl9tdWx0aXBsZSAmJiBzZWxlY3RzLmxlbmd0aCA+IDEgJiYgaXNEZXZNb2RlKCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdTZWxlY3Rpb25TZXQ6IG5vdCBtdWx0aXBsZSBzZWxlY3Rpb24nKTtcbiAgICB9XG5cbiAgICBjb25zdCBiZWZvcmUgPSB0aGlzLl9nZXRDdXJyZW50U2VsZWN0aW9uKCk7XG5cbiAgICBpZiAoIXRoaXMuX211bHRpcGxlKSB7XG4gICAgICB0aGlzLl9zZWxlY3Rpb25NYXAuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b1NlbGVjdDogU2VsZWN0YWJsZVdpdGhJbmRleDxUPltdID0gW107XG4gICAgZm9yIChjb25zdCBzZWxlY3Qgb2Ygc2VsZWN0cykge1xuICAgICAgaWYgKHRoaXMuaXNTZWxlY3RlZChzZWxlY3QpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB0b1NlbGVjdC5wdXNoKHNlbGVjdCk7XG4gICAgICB0aGlzLl9tYXJrU2VsZWN0ZWQodGhpcy5fZ2V0VHJhY2tlZEJ5VmFsdWUoc2VsZWN0KSwgc2VsZWN0KTtcbiAgICB9XG5cbiAgICBjb25zdCBhZnRlciA9IHRoaXMuX2dldEN1cnJlbnRTZWxlY3Rpb24oKTtcblxuICAgIHRoaXMuY2hhbmdlZC5uZXh0KHtiZWZvcmUsIGFmdGVyfSk7XG4gIH1cblxuICBkZXNlbGVjdCguLi5zZWxlY3RzOiBTZWxlY3RhYmxlV2l0aEluZGV4PFQ+W10pIHtcbiAgICBpZiAoIXRoaXMuX211bHRpcGxlICYmIHNlbGVjdHMubGVuZ3RoID4gMSAmJiBpc0Rldk1vZGUoKSkge1xuICAgICAgdGhyb3cgRXJyb3IoJ1NlbGVjdGlvblNldDogbm90IG11bHRpcGxlIHNlbGVjdGlvbicpO1xuICAgIH1cblxuICAgIGNvbnN0IGJlZm9yZSA9IHRoaXMuX2dldEN1cnJlbnRTZWxlY3Rpb24oKTtcbiAgICBjb25zdCB0b0Rlc2VsZWN0OiBTZWxlY3RhYmxlV2l0aEluZGV4PFQ+W10gPSBbXTtcblxuICAgIGZvciAoY29uc3Qgc2VsZWN0IG9mIHNlbGVjdHMpIHtcbiAgICAgIGlmICghdGhpcy5pc1NlbGVjdGVkKHNlbGVjdCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHRvRGVzZWxlY3QucHVzaChzZWxlY3QpO1xuICAgICAgdGhpcy5fbWFya0Rlc2VsZWN0ZWQodGhpcy5fZ2V0VHJhY2tlZEJ5VmFsdWUoc2VsZWN0KSk7XG4gICAgfVxuXG4gICAgY29uc3QgYWZ0ZXIgPSB0aGlzLl9nZXRDdXJyZW50U2VsZWN0aW9uKCk7XG4gICAgdGhpcy5jaGFuZ2VkLm5leHQoe2JlZm9yZSwgYWZ0ZXJ9KTtcbiAgfVxuXG4gIHByaXZhdGUgX21hcmtTZWxlY3RlZChrZXk6IFR8UmV0dXJuVHlwZTxUcmFja0J5RnVuY3Rpb248VD4+LCB0b1NlbGVjdDogU2VsZWN0YWJsZVdpdGhJbmRleDxUPikge1xuICAgIHRoaXMuX3NlbGVjdGlvbk1hcC5zZXQoa2V5LCB0b1NlbGVjdCk7XG4gIH1cblxuICBwcml2YXRlIF9tYXJrRGVzZWxlY3RlZChrZXk6IFR8UmV0dXJuVHlwZTxUcmFja0J5RnVuY3Rpb248VD4+KSB7XG4gICAgdGhpcy5fc2VsZWN0aW9uTWFwLmRlbGV0ZShrZXkpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0VHJhY2tlZEJ5VmFsdWUoc2VsZWN0OiBTZWxlY3RhYmxlV2l0aEluZGV4PFQ+KSB7XG4gICAgaWYgKCF0aGlzLl90cmFja0J5Rm4pIHtcbiAgICAgIHJldHVybiBzZWxlY3QudmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKHNlbGVjdC5pbmRleCA9PSBudWxsICYmIGlzRGV2TW9kZSgpKSB7XG4gICAgICB0aHJvdyBFcnJvcignU2VsZWN0aW9uU2V0OiBpbmRleCByZXF1aXJlZCB3aGVuIHRyYWNrQnlGbiBpcyB1c2VkLicpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl90cmFja0J5Rm4oc2VsZWN0LmluZGV4ISwgc2VsZWN0LnZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgX2dldEN1cnJlbnRTZWxlY3Rpb24oKTogU2VsZWN0YWJsZVdpdGhJbmRleDxUPltdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9zZWxlY3Rpb25NYXAudmFsdWVzKCkpO1xuICB9XG59XG4iXX0=